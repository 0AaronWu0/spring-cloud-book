# 4.1 服务发现简介

通过上文，我们知道硬编码配置的方式存在一些棘手的问题。要想解决这些问题，服务消费者需要一个强大的服务发现机制——使用这种机制，服务消费者无需修改配置文件，就能知道服务提供者的网络信息。提供这种能力的，就是服务发现组件，在微服务架构中，这是一个非常重要的组件。

使用服务发现机制后，架构图大致如图4-1所示：

![服务发现](images/4.1.png)

图4-1 服务发现

如图，服务的启动、使用过程大致如下：

1. 各个微服务启动时，将自己的网络地址等信息注册到服务发现组件中；
2. 服务发现组件会返回服务提供者的地址列表给服务消费者；
3. 服务消费者获得了服务提供者的网络地址，并进行调用；
4. 如果服务提供者网络地址发生了变更（例如服务提供者实例增减或者IP端口发生变化等），服务发现组件会推送给服务消费者；
5. 各微服务与服务发现组件保持心跳，如果长时间心跳断开，服务发现组件则会将该实例踢出。

综上，服务发现组件包含了以下几个功能：

* 服务注册表

服务注册表是一个记录当前可用的服务实例的网络信息的数据库，是服务发现组件的核心。服务注册表提供查询API和管理API，使用查询API获得可用的服务实例，使用管理API实现服务的注册和注销；

* 服务注册

服务注册很好理解，就是服务启动时，将服务的网络地址注册到服务注册表中；

* 健康检查

服务发现组件会通过一些机制定时检测已注册的服务，如果发现某服务无法访问了（可能是某几个心跳周期后），就将该服务从服务注册表中移除。

服务发现的好处是显而易见的。我们不再需要使用硬编码各种网络地址，而只需要服务的名称（或者其他信息）就可以使用该服务。



## TIPS

* 目前市面上的书籍，服务注册、服务发现、注册中心，在多数场景下，都可以理解为是服务发现组件。