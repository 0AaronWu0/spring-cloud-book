# 4.6.3.2.1 使用Java代码自定义Ribbon配置

在Spring Cloud中，Ribbon默认的配置类是`RibbonClientConfiguration` ，它也允许使用一个POJO自定义配置，自定义配置会覆盖默认的配置。

查看`org.springframework.cloud.netflix.ribbon.RibbonClientConfiguration` ，我们会看到以下内容：

```java
	@Bean
	@ConditionalOnMissingBean
	public IRule ribbonRule(IClientConfig config) {
		ZoneAvoidanceRule rule = new ZoneAvoidanceRule();
		rule.initWithNiwsConfig(config);
		return rule;
	}
```

说明在Spring Cloud中，默认的Rule是`ZoneAvoidanceRule` ，这是一种复合判断server所在区域的性能和server的可用性选择server的负载均衡规则。下面我们来写一个DEMO，将Ribbon的负载均衡规则改为随机。





## 准备工作

1. 启动Eureka Server
2. 启动2个或者2个以上节点的用户微服务节点







## 自定义Ribbon配置

配置类：使用@RibbonClient，为该名称的Ribbon Client进行自定义的配置。

```java
@Configuration
@RibbonClient(name = "microservice-provider-user", configuration = RibbonConfiguration.class)
public class RibbonConfiguration {

  @Bean
  public IRule ribbonRule() {
    return new RandomRule();
  }
}
```

Service类：使用`LoadBalancerClient` 提供的API，可以知道当前命中到了哪个用户微服务节点上。





## 测试

启动电影微服务，并多次访问会打印日志如下：

```

```