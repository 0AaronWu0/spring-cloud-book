# 4.6.3.1 Ribbon代码示例

在Spring Cloud中，使用Ribbon非常简单。下面我们来为之前编写的电影微服务添加Ribbon的支持。

* 引入依赖


前文将电影微服务注册到Eureka Server时，添加了`spring-cloud-starter-eureka` ，该依赖已经引入了Ribbon，所以无需手动引入Ribbon的依赖。

* 添加`@LoadBalanced` 注解

回顾之前的代码，在启动类中，实例化RestTemplate的代码如下：

```java
  @Bean
  public RestTemplate restTemplate() {
    return new RestTemplate();
  }
```

为这个方法添加注解`@LoadBalanced` 注解，就可以整合Ribbon，让RestTemplate具备客户端侧负载均衡的能力。

```java
  @Bean
  @LoadBalanced
  public RestTemplate restTemplate() {
    return new RestTemplate();
  }
```

* 修改调用地址：在application.yml中，找到

```
userServiceUrl: http://localhost:7900/
```

修改为：

```
userServiceUrl: http://microservice-provider-user/
```

其中`microservice-provider-user` 是服务提供者的虚拟主机名（virtual host name），当Ribbon和Eureka联合使用时，会自动将虚拟主机名转换成服务在Eureka Server中注册的IP地址并进行调用。





##  TIPS 

虚拟主机名与虚拟IP非常类似，如果大家接触过HAProxy或Heartbeat，理解虚拟主机名就非常容易了。如果理解不了虚拟主机名，那可以简单地认为是提供者在Eureka Server中注册的服务名称，因为默认情况下，虚拟主机名和服务名称是一致的。当然也可以通过配置项`eureka.instance.virtual-host-name`  或者`eureka.instance.secure-virtual-host-name` 来指定虚拟主机名。