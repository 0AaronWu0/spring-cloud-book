# 3.2.3 编写服务消费者

我们已经成功地编写了一个服务提供者（用户微服务），下面我们来编写一个服务消费者（电影微服务）。该服务非常简单，我们使用RestTemplate 调用用户微服务的RESTful API，查询指定用户的信息。

* 首先创建一个Maven项目，在pom.xml中添加如下内容：

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <artifactId>microservice-simple-consumer-movie</artifactId>
  <packaging>jar</packaging>

  <parent>
    <groupId>com.itmuch.cloud</groupId>
    <artifactId>spring-cloud-microservice-study</artifactId>
    <version>0.0.1-SNAPSHOT</version>
  </parent>

  <dependencies>
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-actuator</artifactId>
    </dependency>
  </dependencies>
</project>
```

* 实体类：

```java
public class User {
  private Long id;
  private String username;
  private String name;
  private Integer age;
  private BigDecimal balance;
  ...
  // getters and setters
}
```

* Controller：

```java
@RestController
public class MovieController {
  @Autowired
  private RestTemplate restTemplate;

  @Value("${userServiceUrl}")
  private String userServiceUrl;

  @GetMapping("/simple/{id}")
  public User findById(@PathVariable Long id) {
    return this.restTemplate.getForObject(this.userServiceUrl + "1", User.class);
  }
}
```

* 启动类：

```java
@SpringBootApplication
public class ConsumerMovieApplication {
  @Bean
  public RestTemplate restTemplate() {
    return new RestTemplate();
  }

  public static void main(String[] args) {
    SpringApplication.run(ConsumerMovieApplication.class, args);
  }
}
```

* 配置文件：

```yaml
server:
  port: 7901
userServiceUrl: http://localhost:7900/
```

这样，一个电影微服务就完成了，so easy！



## 测试

访问：[http://127.0.0.1:7901/simple/1](http://127.0.0.1:7901/simple/1) ，获得结果：

```json
{
    "id": 1,
    "username": "account1",
    "name": "张三",
    "age": 20,
    "balance": 100
}
```

结果正常，我们可以正常使用RestTemplate调用用户微服务的API。



## TIPS

* @Bean是一个方法注解，作用是实例化一个Bean，并使用该方法的名称命名。例如：

```java
  @Bean
  public RestTemplate restTemplate() {
    return new RestTemplate();
  }
```

等价于`RestTemplate restTemplate = new RestTemplate();` 。